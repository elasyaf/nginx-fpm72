# mirasz@icube.us
# conf.d/fastcgi-fpm.conf: Managed by swift-express.

location ~ (index|get|static|report|404|503|inpo|loader\-wizard)\.php$ {
#location ~ \.php$ {

	try_files		$uri =404;
	expires			off;
	include			fastcgi_params;

	fastcgi_pass		fastcgi_backend;
	fastcgi_index		index.php;
	fastcgi_buffers		8 16k;
	fastcgi_buffer_size		32k;
	fastcgi_connect_timeout 600s;
	fastcgi_send_timeout	600s;
	fastcgi_read_timeout	600s;

	fastcgi_param		SCRIPT_FILENAME $MAGE_ROOT$fastcgi_script_name;
	fastcgi_param		PHP_FLAG "session.auto_start=off \n suhosin.session.cryptua=off";
	fastcgi_param		MAGE_MODE $MAGE_MODE;
#	fastcgi_param		MAGE_RUN_CODE $MAGE_RUN_CODE;
#	fastcgi_param		MAGE_RUN_TYPE $MAGE_RUN_TYPE;
#	fastcgi_param		HTTPS on;
	fastcgi_param		REMOTE_ADDR $remote_addr;

	allow			all;

	error_page		405 =200 $uri;
	error_log		/var/log/nginx/fastcgi-error.log error;

}

# php-fpm status
location ~ ^/(fpm_status|ping)$ {

	expires			off;
	include			fastcgi_params;

	fastcgi_pass		fastcgi_backend;
	fastcgi_index		index.php;
	fastcgi_buffers		8 16k;
	fastcgi_buffer_size		32k;
	fastcgi_connect_timeout 600s;
	fastcgi_send_timeout	600s;
	fastcgi_read_timeout	600s;
	fastcgi_param			SCRIPT_FILENAME $document_root$fastcgi_script_name;

	allow			127.0.0.1;
	deny			all;
	access_log		off;
	error_log		stderr error;

}
